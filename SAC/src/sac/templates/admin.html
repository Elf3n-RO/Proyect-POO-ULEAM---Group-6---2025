<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SIGACC Web - Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <header>
        <div class="imagen"></div>
        <div class="container">
            <p class="logo">SAC</p>
            <nav>
                {% if admin_logeado %}
                    <a href="/admin-panel">Panel Inicio</a>
                    <a href="/config-page">Configuraci√≥n</a>
                    <a href="/">Cerrar Sesi√≥n</a>
                {% else %}
                    <a href="#">Soporte</a>
                {% endif %}
            </nav>
        </div>
    </header>

    <section id="principal" style="height: auto; min-height: 80vh; padding-bottom: 50px;">
    <div class="container">    
        {% if not admin_logeado %}
            <h1>Bienvenido al Sistema de Asignaci√≥n de Cupos</h1>
            <form action="/login" method="POST" class="POST">
                <label for="correo">‚úâÔ∏è Correo Institucional</label>
                <input type="email" id="correo" name="correo" required>
                <label for="contrasena">üîí Contrase√±a</label>
                <input type="password" id="contrasena" name="contrasena" required>
                <button type="submit">Iniciar Sesi√≥n</button>
            </form>
        {% else %}
            <h1 style="text-align: center; margin-bottom: 30px;">Panel de Administraci√≥n SAC</h1>

            <details open style="margin-bottom: 20px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                <summary class="titulo-seccion" style="cursor: pointer; list-style: none; display: flex; align-items: center; justify-content: space-between;">
                    <span>Ofertas Acad√©micas</span>
                    <span style="font-size: 0.7em;">(Haz clic para contraer/expandir)</span>
                </summary>
                
                <div style="padding: 15px;">
                    <table class="tabla-datos">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Carrera</th>
                                <th>Cupos Totales</th>
                                <th>Disponibles</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for carrera in carreras %}
                            <tr>
                                <td style="font-family: monospace; font-weight: bold;">{{ carrera.codigo }}</td>
                                <td>{{ carrera.nombre }}</td>
                                <td>{{ carrera.cuposTotales }}</td>
                                <td><strong style="color: #d32f2f;">{{ carrera.cuposDisponibles }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </details>
                
                <details style="margin-bottom: 20px; border-radius: 10px;">
                    <summary class="titulo-seccion" style="cursor: pointer; list-style: none; display: flex; align-items: center; justify-content: space-between;">
                        üë• Postulantes y Estados de Asignaci√≥n
                        <span style="font-size: 0.7em;">(Haz clic para contraer/expandir)</span>
                    </summary>
                    <div style="padding: 15px;">
                        <table class="tabla-datos">
                            <thead>
                                <tr>
                                    <th>Identificaci√≥n</th>
                                    <th>Postulante</th>
                                    <th>Puntaje</th>
                                    <th>Vulnerabilidad</th>
                                    <th>Fecha de registro</th>
                                    <th>Asignaci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for p in postulantes %}
                                <tr>
                                    <td>{{ p.identificacion }}</td>
                                    <td>{{ p.nombres }} {{ p.apellidos }}</td>
                                    <td><strong>{{ p.puntaje }}</strong></td>
                                    <td>{{ p.vulnerabilidad }}</td>
                                    <td>{{ p.fecha_inscripcion.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        {% if p.asignaciones %}
                                            <b style="color: green;">ASIGNADO: {{ p.asignaciones[0].carrera.nombre }}</b>
                                        {% else %}
                                            <i style="color: #999;">Pendiente</i>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </details>

                <div style="text-align: center; margin-top: 30px;">
                    <form action="/ejecutar-asignacion" method="POST">
                        <button type="submit" class="btn-logica">
                            üöÄ Ejecutar Asignaci√≥n de Cupos (Art. 51)
                        </button>
                    </form>
                    <p id="msgCarga" style="display:none; color: white; margin-top: 10px;">
                        ‚è≥ Procesando algoritmos de desempate y actualizando base de datos...
                    </p>
                </div>

                <script>
                function mostrarCarga() {
                    document.getElementById('btnAsignar').style.display = 'none';
                    document.getElementById('msgCarga').style.display = 'block';
                }
                </script>
                </div>
            {% endif %}
        </div>
    </section>

    <section id="ayuda">
        <div class="container">
            <nav>
                {% if admin_logeado %}

                    <form action="/report-page" method="POST">
                        <button type="submit">üìä Generar Reportes</button>

                    </form>
                {% else %}
                    <a href="#">Soporte t√©cnico</a>
                    <a href="#">¬øNecesitas Ayuda?</a>
                {% endif %}
            </nav>
        </div>
    </section>
</body>
</html>
